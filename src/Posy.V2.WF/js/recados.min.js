$(document).ready(function(){b();$(document).on("click",".ed-cnt-cmt .btnAddPost",function(){if($(this).closest(".ed-cnt-cmt").attr("id")=="cmtRecadoFrame"){e($(this).closest(".ed-cnt-cmt"))}else{g($(this).closest(".ed-cnt-cmt"))}});$(document).on("click",".btnMenuItem",function(){if($(this).attr("opcao")=="RE"){c($(this))}else{if($(this).attr("opcao")=="RB"){h($(this))}else{if($(this).attr("opcao")=="RCE"){f($(this))}}}});$(document).on("click",".btnExcluirRecadoCheck",function(){i($(this))});$(document).on("click",".btnVerMais",function(){d($(this),$(this).attr("codrecado"),$(this).attr("codcomentultimo"))});$(document).on("click",".btnVerMenos",function(){a($(this),$(this).attr("codrecado"),"-1")});function e(k){var n;var l=k.find(".the-new-com"),j=l.get(0).nodeName;if(j=="IFRAME"){n=l.contents().find("body").html()}else{n=l.val()}if(n==""){alert("Nenhum texto para o post.");return false}var o=k.find(".btnAddPost");o.buttonLoader("start");var p=new Object();p.CodRecado="-1";p.Recado=n;var m={objeto:p};perfil.metodo="SalvarRecado";perfil.data=JSON.stringify(m);perfil.ajaxWs(function(t){o.buttonLoader("stop");var r=t.d;if($(".view-page .tl-cnt-default").length==0){$(".view-page").html("<section class='tl-cnt-default'></section>")}$(r[0]).hide().prependTo(".view-page .tl-cnt-default").fadeIn("slow");$(".view-page .tl-cnt-default").find(".ed-cnt-cmt:eq(0)").editorHtml();var q=$(".ms-tit-blc-btn"),s=(q.text()===undefined||q.text()=="")?0:parseInt(q.text());q.text((s+1));fnNotificacao("success","Sucesso na operação.",V_TIME_MESSAGE);setTimeout(function(){$(".postado-recente").removeClass("postado-recente")},500);fnOcultarContainerEditor(k);$(".view-page .tl-cnt-default .tooltip-dropmenu:eq(0)").tipsy({trigger:"click",gravity:"n",html:true,title:function(){return $(this).find(".tooltip-dropmenu-html-container").html()}})})}function g(k){var n;var l=k.find(".the-new-com"),j=l.get(0).nodeName;if(j=="IFRAME"){n=l.contents().find("body").html()}else{n=l.val()}if(n==""){fnNotificacao("warning","Nenhum texto para o post.",V_TIME_MESSAGE);return false}var o=k.find(".btnAddPost");o.buttonLoader("start");var p=new Object();p.CodRecado=k.closest(".tl-cnt-default-block").attr("codrecado");p.Coment=n;var m={objeto:p};perfil.metodo="SalvarRecadoComentario";perfil.data=JSON.stringify(m);perfil.ajaxWs(function(r){o.buttonLoader("stop");fnOcultarContainerEditor(k);var q=r.d;if(parseInt(q[0])==1){$(q[1]).hide().prependTo(k.find(".ed-cnt-cmt-coments")).fadeIn("slow");fnNotificacao("success","Sucesso na operação.",V_TIME_MESSAGE);setTimeout(function(){$(".postado-recente").removeClass("postado-recente")},500);k.find(".ed-cnt-cmt-coments").find(".tooltip-dropmenu:eq(0)").tipsy({trigger:"click",gravity:"n",html:true,title:function(){return $(this).find(".tooltip-dropmenu-html-container").html()}});$(".cmt-cnt-img-perfil-tooltip-big").tipsy({trigger:"click",gravity:"s",html:true,title:function(){return $(this).next().html()}})}else{fnNotificacao("error",q[1],V_TIME_MESSAGE)}})}function c(l){var k=$(".tooltip-dropmenu-container[codrecado="+l.attr("codrecado")+"]");k.buttonLoader("start");var m=new Object();m.CodRecado=l.attr("codrecado");var j={objeto:m};perfil.metodo="ExcluirRecado";perfil.data=JSON.stringify(j);perfil.ajaxWs(function(p){k.buttonLoader("stop");var n=$(".ms-tit-blc-btn"),o=(n.text()===undefined||n.text()=="")?0:parseInt(n.text());o=((o-1)<0)?0:o;n.text((o-1));$(".tl-cnt-default-block[codrecado="+l.attr("codrecado")+"]").fadeOut(300,function(){$(this).remove();if($(".view-page .tl-cnt-default .tl-cnt-default-block").length==0){$(".view-page").html("");$(".view-pager").html("");$(".view-btntop").html("")}});fnNotificacao("success","Sucesso na operação.",V_TIME_MESSAGE)})}function f(l){var k=$(".cmt-cnt[codcoment="+l.attr("codcoment")+"]");k.buttonLoader("start");var m=new Object();m.CodComent=l.attr("codcoment");var j={objeto:m};perfil.metodo="ExcluirRecadoComentario";perfil.data=JSON.stringify(j);perfil.ajaxWs(function(n){k.buttonLoader("stop");$(".cmt-cnt[codcoment="+l.attr("codcoment")+"]").fadeOut(300,function(){$(this).remove()});fnNotificacao("success","Sucesso na operação.",V_TIME_MESSAGE)})}function i(l){if($(".tl-checkbox:checked").length==0){fnNotificacao("warning","Nenhum recado selecionado.",V_TIME_MESSAGE);return false}var j=new Array();$(".tl-checkbox:checked").each(function(){var m=new Object();m.CodRecado=$(this).val();j.push(m)});$(l).buttonLoader("start");var k={lista:j};perfil.metodo="ExcluirMultiplosRecados";perfil.data=JSON.stringify(k);perfil.ajaxWs(function(m){$(l).buttonLoader("stop");$(".tl-checkbox:checked").each(function(){$(this).closest(".tl-cnt-default-block").fadeOut(300,function(){$(this).remove();if($(".view-page .tl-cnt-default .tl-cnt-default-block").length==0){$(".view-page").html("");$(".view-pager").html("");$(".view-btntop").html("")}})});fnNotificacao("success","Sucesso na operação.",V_TIME_MESSAGE)})}function d(l,j,k){$(l).buttonLoader("start");perfil.metodo="getListRecadoComentarios";perfil.data="{'p_codrecado':'"+j+"','p_codcoment_ultimo':'"+k+"'}";perfil.ajaxWs(function(m){$(l).buttonLoader("stop");l.closest(".ed-cnt-cmt-more").remove();$(".tl-cnt-default-block[codrecado="+j+"] .ed-cnt-cmt-coments").append(m.d);$(".tl-cnt-default-block[codrecado="+j+"] .ed-cnt-cmt-coments .cmt-cnt").fadeIn("slow");$(".tooltip-dropmenu").tipsy({trigger:"click",gravity:"n",html:true,title:function(){return $(this).find(".tooltip-dropmenu-html-container").html()}});$(".cmt-cnt-img-perfil-tooltip-big").tipsy({trigger:"click",gravity:"s",html:true,title:function(){return $(this).next().html()}})})}function a(o,k,l){var m=1,j=-1;$(".tl-cnt-default-block[codrecado="+k+"] .ed-cnt-cmt-coments .cmt-cnt").each(function(){if(m>4){$(this).fadeOut(300,function(){$(this).remove()})}else{j=$(this).attr("codcoment")}m++});m--;var n="<a href='javascript:void(0);' class='button minor1 btnVerMais' codrecado='"+k+"' codcomentultimo='"+j+"'>Ver mais comentários</a>";o.closest(".ed-cnt-cmt-more").html(n)}function h(l){var j=$(".tl-cnt-default-block[codrecado="+l.attr("codrecado")+"]");j.buttonLoader("start");var m=new Object();m.CodPerfilBloqueado=l.attr("codperfil");var k={objeto:m};perfil.metodo="BloquearPost";perfil.data=JSON.stringify(k);perfil.ajaxWs(function(n){j.buttonLoader("stop");j.fadeOut(300,function(){$(this).remove()});fnNotificacao("success","Sucesso na operação.",V_TIME_MESSAGE)})}function b(){var j=$(".mv-loading").boxLoader();fnLimparViewPerfil();perfil.metodo="getPerfilRecadosView";perfil.data="";perfil.ajaxWs(function(r){j.stop();var q=r.d,l=q[0],m=q[1],p=q[2],n=q[3],o=q[4],k=q[5];fnShowViewPerfil(l,m,p,n,o,k);$(".view-btntop").html(k[4]);$(".view-page .tl-cnt-default .tl-cnt-default-block").fadeIn("slow");$(".view-editor").html(k[3]);$(".view-editor .ed-cnt-cmt").editorHtml();$(".ed-cnt-cmt[bloqueado=0]").editorHtml();$(".cmt-cnt-img-perfil-tooltip-big").tipsy({trigger:"click",gravity:"s",html:true,title:function(){return $(this).next().html()}});fnInicializaViewPerfil()})}});